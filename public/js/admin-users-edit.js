(self.webpackChunk=self.webpackChunk||[]).push([[8313],{69378:(e,t,r)=>{"use strict";function n(e){return Array.isArray(e)}function a(e,t,r){return t=t||new FormData,void 0===e||(n(e)?e.forEach((function(e){a(e,t,r+"[]")})):!function(e){return e===Object(e)}(e)||function(e){return e instanceof File}(e)||function(e){return e instanceof Date}(e)?t.append(r,e):Object.keys(e).forEach((function(s){var i=e[s];if(n(i))for(;s.length>2&&s.lastIndexOf("[]")===s.length-2;)s=s.substring(0,s.length-2);a(i,t,r?r+"["+s+"]":s)}))),t}r.d(t,{Z:()=>a})},27686:(e,t,r)=>{"use strict";r.d(t,{Z:()=>o});var n=r(94015),a=r.n(n),s=r(23645),i=r.n(s)()(a());i.push([e.id,".v-avatar[data-v-5454ed8e]{cursor:pointer}","",{version:3,sources:["webpack://./resources/js/components/Admin/FileUpload.vue"],names:[],mappings:"AA6IA,2BACA,cACA",sourcesContent:['<template>\n  <div>\n    <v-text-field\n      :value="path"\n      :label="label"\n      :disabled="disabled || form.busy"\n      append-icon="mdi-paperclip"\n      :append-outer-icon="preview && clearable ? \'mdi-delete\' : \'\'"\n      outlined\n      readonly\n      :error="!!error"\n      :error-messages="error"\n      @click:append="$refs.input.click()"\n      @click:append-outer="clear"\n    >\n      <template v-slot:prepend-inner>\n        <v-avatar height="28" width="auto" max-width="56" tile @click="!disabled && $refs.input.click()">\n          <img v-if="preview" :src="preview" :alt="label" :disabled="disabled || form.busy">\n          <v-icon v-else :disabled="disabled || form.busy">\n            mdi-image-outline\n          </v-icon>\n        </v-avatar>\n      </template>\n      <template v-slot:append-outer>\n        <slot name="append-outer" />\n      </template>\n    </v-text-field>\n\n    <input ref="input" type="file" class="d-none" :accept="accept" @change="uploadFile">\n  </div>\n</template>\n\n<script>\nimport Form from \'vform\'\nimport objectToFormData from \'~/plugins/objectToFormData\'\n\nexport default {\n  props: {\n    label: {\n      type: String,\n      required: true\n    },\n    value: {\n      validator: value => typeof value === \'string\' || value === null,\n      required: true\n    },\n    accept: {\n      type: String,\n      required: false,\n      default: \'image/*\'\n    },\n    name: {\n      type: String,\n      required: true\n    },\n    folder: {\n      type: String,\n      required: true\n    },\n    clearable: {\n      type: Boolean,\n      required: false,\n      default: false\n    },\n    disabled: {\n      type: Boolean,\n      required: false,\n      default: false\n    }\n  },\n\n  data () {\n    return {\n      error: null,\n      imageBase64: null,\n      form: new Form({\n        file: null,\n        name: this.name,\n        folder: this.folder\n      }),\n      uploadedFilePath: null\n    }\n  },\n\n  computed: {\n    path () {\n      return this.form.busy\n        ? this.$t(\'Uploading...\')\n        : ((!this.uploadedFilePath && !this.value) || this.uploadedFilePath === \'\'\n          ? this.$t(\'Upload a file\')\n          : (this.uploadedFilePath || this.displayValue))\n    },\n    preview () {\n      return this.imageBase64 || this.displayValue\n    },\n    displayValue () {\n      return this.value && !this.value.match(/\\//) ? `/storage/${this.folder}/${this.value}` : this.value\n    }\n  },\n\n  watch: {\n    uploadedFilePath (uploadedFilePath) {\n      this.$emit(\'input\', uploadedFilePath)\n    }\n  },\n\n  methods: {\n    clear () {\n      this.uploadedFilePath = \'\'\n      this.imageBase64 = null\n    },\n    async uploadFile (event) {\n      this.error = null\n\n      this.form.file = event.target.files[0]\n\n      if (this.form.file) {\n        let imageBase64\n        const reader = new FileReader()\n        // define a callback function to run, when FileReader finishes its job\n        reader.onload = e => { imageBase64 = e.target.result }\n        // Start the reader job - read file as a data url (base64 format)\n        reader.readAsDataURL(this.form.file)\n\n        const options = { transformRequest: [(data, headers) => objectToFormData(data)] }\n\n        const { data } = await this.form.submit(\'post\', \'/api/admin/files\', options)\n\n        if (data.success) {\n          this.uploadedFilePath = data.path\n\n          this.imageBase64 = imageBase64\n        } else {\n          this.error = data.message\n        }\n      }\n    }\n  }\n}\n<\/script>\n<style scoped>\n.v-avatar {\n  cursor: pointer;\n}\n</style>\n'],sourceRoot:""}]);const o=i},90304:(e,t,r)=>{"use strict";r.d(t,{Z:()=>u});var n=r(87757),a=r.n(n),s=r(50175),i=r.n(s),o=r(69378);function l(e,t,r,n,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,a)}const u={props:{label:{type:String,required:!0},value:{validator:function(e){return"string"==typeof e||null===e},required:!0},accept:{type:String,required:!1,default:"image/*"},name:{type:String,required:!0},folder:{type:String,required:!0},clearable:{type:Boolean,required:!1,default:!1},disabled:{type:Boolean,required:!1,default:!1}},data:function(){return{error:null,imageBase64:null,form:new(i())({file:null,name:this.name,folder:this.folder}),uploadedFilePath:null}},computed:{path:function(){return this.form.busy?this.$t("Uploading..."):!this.uploadedFilePath&&!this.value||""===this.uploadedFilePath?this.$t("Upload a file"):this.uploadedFilePath||this.displayValue},preview:function(){return this.imageBase64||this.displayValue},displayValue:function(){return this.value&&!this.value.match(/\//)?"/storage/".concat(this.folder,"/").concat(this.value):this.value}},watch:{uploadedFilePath:function(e){this.$emit("input",e)}},methods:{clear:function(){this.uploadedFilePath="",this.imageBase64=null},uploadFile:function(e){var t,r=this;return(t=a().mark((function t(){var n,s,i,l,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.error=null,r.form.file=e.target.files[0],!r.form.file){t.next=12;break}return(s=new FileReader).onload=function(e){n=e.target.result},s.readAsDataURL(r.form.file),i={transformRequest:[function(e,t){return(0,o.Z)(e)}]},t.next=9,r.form.submit("post","/api/admin/files",i);case 9:l=t.sent,(u=l.data).success?(r.uploadedFilePath=u.path,r.imageBase64=n):r.error=u.message;case 12:case"end":return t.stop()}}),t)})),function(){var e=this,r=arguments;return new Promise((function(n,a){var s=t.apply(e,r);function i(e){l(s,n,a,i,o,"next",e)}function o(e){l(s,n,a,i,o,"throw",e)}i(void 0)}))})()}}}},41092:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n});const n={props:["id","small"]}},50861:(e,t,r)=>{"use strict";var n=r(93379),a=r.n(n),s=r(27686),i={insert:"head",singleton:!1};a()(s.Z,i);s.Z.locals},29366:(e,t,r)=>{"use strict";r.d(t,{s:()=>n,x:()=>a});var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-text-field",{attrs:{value:e.path,label:e.label,disabled:e.disabled||e.form.busy,"append-icon":"mdi-paperclip","append-outer-icon":e.preview&&e.clearable?"mdi-delete":"",outlined:"",readonly:"",error:!!e.error,"error-messages":e.error},on:{"click:append":function(t){return e.$refs.input.click()},"click:append-outer":e.clear},scopedSlots:e._u([{key:"prepend-inner",fn:function(){return[r("v-avatar",{attrs:{height:"28",width:"auto","max-width":"56",tile:""},on:{click:function(t){!e.disabled&&e.$refs.input.click()}}},[e.preview?r("img",{attrs:{src:e.preview,alt:e.label,disabled:e.disabled||e.form.busy}}):r("v-icon",{attrs:{disabled:e.disabled||e.form.busy}},[e._v("\n          mdi-image-outline\n        ")])],1)]},proxy:!0},{key:"append-outer",fn:function(){return[e._t("append-outer")]},proxy:!0}],null,!0)}),e._v(" "),r("input",{ref:"input",staticClass:"d-none",attrs:{type:"file",accept:e.accept},on:{change:e.uploadFile}})],1)},a=[]},96992:(e,t,r)=>{"use strict";r.d(t,{s:()=>n,x:()=>a});var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-menu",{attrs:{"offset-y":!0,transition:"scroll-y-transition",bottom:"",left:""},scopedSlots:e._u([{key:"activator",fn:function(t){var n=t.on;return[r("v-btn",e._g({attrs:{icon:""}},n),[r("v-icon",{attrs:{small:e.small}},[e._v("mdi-dots-vertical")])],1)]}}])},[e._v(" "),r("v-list",[r("v-list-item",{attrs:{to:{name:"users.show",params:{id:e.id}},exact:""}},[r("v-list-item-icon",[r("v-icon",{attrs:{small:e.small}},[e._v("mdi-account")])],1),e._v(" "),r("v-list-item-content",[r("v-list-item-title",[e._v(e._s(e.$t("Profile")))])],1)],1),e._v(" "),r("v-list-item",{attrs:{to:{name:"admin.users.show",params:{id:e.id}},exact:""}},[r("v-list-item-icon",[r("v-icon",{attrs:{small:e.small}},[e._v("mdi-eye")])],1),e._v(" "),r("v-list-item-content",[r("v-list-item-title",[e._v(e._s(e.$t("View")))])],1)],1),e._v(" "),r("v-list-item",{attrs:{to:{name:"admin.users.edit",params:{id:e.id}},exact:""}},[r("v-list-item-icon",[r("v-icon",{attrs:{small:e.small}},[e._v("mdi-pencil")])],1),e._v(" "),r("v-list-item-content",[r("v-list-item-title",[e._v(e._s(e.$t("Edit")))])],1)],1),e._v(" "),r("v-list-item",{attrs:{to:{name:"admin.users.delete",params:{id:e.id}},exact:""}},[r("v-list-item-icon",[r("v-icon",{attrs:{small:e.small}},[e._v("mdi-delete")])],1),e._v(" "),r("v-list-item-content",[r("v-list-item-title",[e._v(e._s(e.$t("Delete")))])],1)],1),e._v(" "),r("v-list-item",{attrs:{to:{name:"admin.users.mail",params:{id:e.id}},exact:""}},[r("v-list-item-icon",[r("v-icon",{attrs:{small:e.small}},[e._v("mdi-email-outline")])],1),e._v(" "),r("v-list-item-content",[r("v-list-item-title",[e._v(e._s(e.$t("E-mail")))])],1)],1)],1)],1)},a=[]},98668:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>R});var n=r(87757),a=r.n(n),s=r(9669),i=r.n(s),o=r(50175),l=r.n(o),u=r(18623),d=r(95792),c=r(69010);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(e,t,r,n,a,s,i){try{var o=e[s](i),l=o.value}catch(e){return void r(e)}o.done?t(l):Promise.resolve(l).then(n,a)}function p(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var s=e.apply(t,r);function i(e){f(s,n,a,i,o,"next",e)}function o(e){f(s,n,a,i,o,"throw",e)}i(void 0)}))}}function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){b(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const y={components:{FileUpload:r(31778).Z,Preloader:c.Z,UserMenu:d.Z},mixins:[u.Z],middleware:["auth","verified","2fa_passed","admin"],props:["id"],metaInfo:function(){return{title:this.$t("User {0}",[this.id])}},data:function(){return{user:null,roles:[],accessModes:[],permissions:{},individualPermissions:!1,showPassword:!1,form:new(l())({name:null,email:null,role:null,permissions:null,avatar:null,status:null,hide_profit:null,banned_from_chat:null})}},computed:{changed:function(){var e=this;return this.form.keys().some((function(t){return e.user&&e.form[t]!==e.user[t]}))}},watch:{individualPermissions:function(e){e&&!this.form.permissions?this.form.permissions=h({},Object.keys(this.permissions).reduce((function(e,t){return h(h({},e),{},b({},t,0))}),{})):e||(this.form.permissions=null)},"form.role":function(e){2!==e&&(this.individualPermissions=!1)}},created:function(){var e=this;return p(a().mark((function t(){var r,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i().get("/api/admin/users/".concat(e.id));case 2:r=t.sent,n=r.data,e.user=n.user,e.roles=Object.keys(n.roles).map((function(e){return{value:parseInt(e,10),text:n.roles[e]}})),e.accessModes=Object.keys(n.access_modes).map((function(e){return{value:parseInt(e,10),text:n.access_modes[e]}})),e.permissions=n.permissions,e.user.permissions&&(e.individualPermissions=!0),e.form.keys().forEach((function(t){var r=e.user[t];e.form[t]=null!==r&&"object"===m(r)?h({},r):r}));case 10:case"end":return t.stop()}}),t)})))()},methods:{update:function(){var e=this;return p(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.form.patch("/api/admin/users/".concat(e.id));case 2:e.$store.dispatch("message/success",{text:e.$t("User successfully updated.")}),e.$router.push({name:"admin.users.index"});case 4:case"end":return t.stop()}}),t)})))()}}};var _=r(51900),g=r(43453),w=r.n(g),x=r(4330),k=r(43776),$=r(5255),P=r(17024),F=r(66530),V=r(83240),Z=r(6571),j=r(57894),O=r(9047),S=r(55515),B=r(22515),q=r(13234),E=r(54933),C=r(40961),A=r(73845),D=(0,_.Z)(y,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-container",[r("v-row",{attrs:{align:"center",justify:"center"}},[r("v-col",{attrs:{cols:"12",md:"6"}},[r("v-card",[r("v-toolbar",[r("v-btn",{attrs:{icon:""},on:{click:function(t){return e.$router.go(-1)}}},[r("v-icon",[e._v("mdi-arrow-left")])],1),e._v(" "),r("v-toolbar-title",[e._v("\n            "+e._s(e.$t("User {0}",[e.id]))+"\n          ")]),e._v(" "),r("v-spacer"),e._v(" "),r("user-menu",{attrs:{id:e.id}}),e._v(" "),r("preloader",{attrs:{active:!e.user}})],1),e._v(" "),r("v-card-text",[r("v-form",{on:{submit:function(t){return t.preventDefault(),e.update(t)}},model:{value:e.formIsValid,callback:function(t){e.formIsValid=t},expression:"formIsValid"}},[r("v-text-field",{attrs:{label:e.$t("Name"),type:"text",disabled:e.form.busy||!e.user,rules:[e.validationRequired],error:e.form.errors.has("name"),"error-messages":e.form.errors.get("name"),outlined:""},on:{keydown:function(t){return e.clearFormErrors(t,"name")}},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}}),e._v(" "),r("v-text-field",{attrs:{label:e.$t("Email"),type:"email",disabled:e.form.busy||!e.user,rules:[e.validationRequired,e.validationEmail],error:e.form.errors.has("email"),"error-messages":e.form.errors.get("email"),outlined:""},on:{keydown:function(t){return e.clearFormErrors(t,"email")}},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}}),e._v(" "),r("v-select",{attrs:{items:e.roles,label:e.$t("Role"),disabled:e.form.busy||!e.user,error:e.form.errors.has("role"),"error-messages":e.form.errors.get("role"),outlined:""},model:{value:e.form.role,callback:function(t){e.$set(e.form,"role",t)},expression:"form.role"}}),e._v(" "),2===e.form.role?r("v-switch",{staticClass:"mb-5",attrs:{label:e.$t("Individual permissions"),color:"primary",disabled:e.form.busy||!e.user},model:{value:e.individualPermissions,callback:function(t){e.individualPermissions=t},expression:"individualPermissions"}}):e._e(),e._v(" "),2===e.form.role&&e.individualPermissions?r("v-card",{staticClass:"mb-10",attrs:{outlined:""}},[r("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                "+e._s(e.$t("Permissions"))+"\n              ")]),e._v(" "),r("v-card-text",e._l(e.permissions,(function(t,n){return r("v-row",{key:n,staticClass:"align-center"},[r("v-col",{attrs:{cols:"6"}},[e._v("\n                    "+e._s(t)+"\n                  ")]),e._v(" "),r("v-col",{attrs:{cols:"6"}},[null!==e.form.permissions?r("v-select",{attrs:{items:e.accessModes,label:e.$t("Access"),"hide-details":"",dense:"",outlined:""},model:{value:e.form.permissions[n],callback:function(t){e.$set(e.form.permissions,n,t)},expression:"form.permissions[id]"}}):e._e()],1)],1)})),1)],1):e._e(),e._v(" "),e.user?r("file-upload",{attrs:{label:e.$t("Avatar"),name:e.user.id.toString(),path:"/storage/avatars",folder:"avatars"},model:{value:e.form.avatar,callback:function(t){e.$set(e.form,"avatar",t)},expression:"form.avatar"}}):e._e(),e._v(" "),r("v-text-field",{attrs:{label:e.$t("Password"),"append-icon":e.showPassword?"mdi-eye":"mdi-eye-off",type:e.showPassword?"text":"password",disabled:e.form.busy||!e.user,error:e.form.errors.has("password"),"error-messages":e.form.errors.get("password"),hint:e.$t("Leave empty to preserve current user password."),"persistent-hint":"",outlined:"",counter:!0},on:{"click:append":function(t){e.showPassword=!e.showPassword},keydown:function(t){return e.clearFormErrors(t,"password")}},model:{value:e.form.password,callback:function(t){e.$set(e.form,"password",t)},expression:"form.password"}}),e._v(" "),r("v-switch",{attrs:{label:e.$t("Blocked"),color:"primary",disabled:e.form.busy||!e.user,"false-value":0,"true-value":1},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}}),e._v(" "),r("v-switch",{attrs:{label:e.$t("Hide profit"),color:"primary",disabled:e.form.busy||!e.user,"false-value":!1,"true-value":!0},model:{value:e.form.hide_profit,callback:function(t){e.$set(e.form,"hide_profit",t)},expression:"form.hide_profit"}}),e._v(" "),r("v-switch",{attrs:{label:e.$t("Banned from chat"),color:"primary",disabled:e.form.busy||!e.user,"false-value":!1,"true-value":!0},model:{value:e.form.banned_from_chat,callback:function(t){e.$set(e.form,"banned_from_chat",t)},expression:"form.banned_from_chat"}}),e._v(" "),r("v-skeleton-loader",{attrs:{type:"button",loading:!e.user}},[r("v-btn",{attrs:{type:"submit",color:"primary",disabled:!e.formIsValid||!e.changed||e.form.busy,loading:e.form.busy}},[e._v("\n                "+e._s(e.$t("Save"))+"\n              ")])],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null);const R=D.exports;w()(D,{VBtn:x.Z,VCard:k.Z,VCardText:$.ZB,VCardTitle:$.EB,VCol:P.Z,VContainer:F.Z,VForm:V.Z,VIcon:Z.Z,VRow:j.Z,VSelect:O.Z,VSkeletonLoader:S.Z,VSpacer:B.Z,VSwitch:q.Z,VTextField:E.Z,VToolbar:C.Z,VToolbarTitle:A.qW})}}]);
//# sourceMappingURL=admin-users-edit.js.map