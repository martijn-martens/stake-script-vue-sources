(self.webpackChunk=self.webpackChunk||[]).push([[430],{10853:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Z});var a=n(87757),r=n.n(a),o=n(9669),s=n.n(o),c=n(50175),i=n.n(c),m=n(18623),d=n(68843);function l(e,t,n,a,r,o,s){try{var c=e[o](s),i=c.value}catch(e){return void n(e)}c.done?t(i):Promise.resolve(i).then(a,r)}function u(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function s(e){l(o,a,r,s,c,"next",e)}function c(e){l(o,a,r,s,c,"throw",e)}s(void 0)}))}}const v={middleware:["auth","verified","2fa_passed","admin"],metaInfo:function(){return{title:this.$t("Maintenance")}},mixins:[m.Z],computed:{commands:function(){return this.data.commands?this.data.commands.map((function(e){return{value:e.class,text:e.description}})):[]}},data:function(){return{data:{},maintenanceFormIsValid:null,maintenanceForm:new(i())({message:this.$t("Sorry, we are doing some maintenance. Please check back soon.")}),commandFormIsValid:null,commandForm:new(i())({command:null,arguments:{}}),migrationForm:new(i()),cacheForm:new(i()),cronForm:new(i())}},created:function(){var e=this;return u(r().mark((function t(){var n,a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,s().get("/api/admin/maintenance");case 2:n=t.sent,a=n.data,e.data=a;case 5:case"end":return t.stop()}}),t)})))()},methods:{switchMaintenanceMode:function(){var e=this;return u(r().mark((function t(){var n,a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.data.maintenance_mode?"up":"down",t.next=3,e.maintenanceForm.post("/api/admin/maintenance/".concat(n));case 3:a=t.sent,o=a.data,e.data.maintenance_mode=!e.data.maintenance_mode,e.$store.dispatch("message/success",{text:o.message});case 7:case"end":return t.stop()}}),t)})))()},executeCommand:function(){var e=this;return u(r().mark((function t(){var n,a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.commandForm.post("/api/admin/maintenance/command");case 2:n=t.sent,a=n.data,e.$store.dispatch("message/success",{text:a.message});case 5:case"end":return t.stop()}}),t)})))()},migrate:function(){var e=this;return u(r().mark((function t(){var n,a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.migrationForm.post("/api/admin/maintenance/migrate");case 2:n=t.sent,a=n.data,e.$store.dispatch("message/success",{text:a.message});case 5:case"end":return t.stop()}}),t)})))()},clearCache:function(){var e=this;return u(r().mark((function t(){var n,a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.cacheForm.post("/api/admin/maintenance/cache");case 2:n=t.sent,a=n.data,e.$store.dispatch("message/success",{text:a.message});case 5:case"end":return t.stop()}}),t)})))()},cron:function(){var e=this;return u(r().mark((function t(){var n,a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.cronForm.post("/api/admin/maintenance/cron");case 2:n=t.sent,a=n.data,e.$store.dispatch("message/success",{text:a.message});case 5:case"end":return t.stop()}}),t)})))()},copyToClipboard:function(e){return(0,d.vQ)(e.$el.querySelector("input"))}}};var p=n(51900),_=n(43453),f=n.n(_),h=n(4330),b=n(43776),g=n(5255),w=n(17024),x=n(66530),F=n(83240),y=n(6571),$=n(57894),k=n(9047),C=n(55515),V=n(54933),I=(0,p.Z)(v,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",[n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-card",[n("v-card-title",[e._v("\n          "+e._s(e.$t("Maintenance"))+"\n        ")]),e._v(" "),n("v-card-text",[n("v-row",[n("v-col",[n("v-card",{attrs:{outlined:""}},[n("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("System info"))+"\n                ")]),e._v(" "),n("v-card-text",[n("v-skeleton-loader",{attrs:{type:"text",loading:!e.data.system_info}},[e._v("\n                    "+e._s(e.data.system_info)+"\n                  ")])],1)],1)],1)],1),e._v(" "),n("v-row",[n("v-col",[n("v-card",{attrs:{outlined:""}},[n("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Application info"))+"\n                ")]),e._v(" "),n("v-card-text",[n("v-skeleton-loader",{attrs:{type:"text",loading:!e.data.current_version}},[e.data.update_available?n("p",{staticClass:"warning--text mb-0"},[n("v-icon",{attrs:{color:"warning",left:""}},[e._v("\n                        mdi-alert\n                      ")]),e._v("\n                      "+e._s(e.$t("New version {0} is available ({1} currently installed).",[e.data.latest_version,e.data.current_version]))+"\n                    ")],1):n("p",{staticClass:"success--text mb-0"},[n("v-icon",{attrs:{color:"success",left:""}},[e._v("\n                        mdi-check-all\n                      ")]),e._v("\n                      "+e._s(e.$t("Application is up-to-date (version {0} is installed).",[e.data.latest_version]))+"\n                    ")],1)])],1)],1)],1)],1),e._v(" "),n("v-row",[n("v-col",[n("v-card",{attrs:{outlined:""}},[n("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Maintenance mode"))+"\n                ")]),e._v(" "),n("v-card-text",[n("p",[e._v("\n                  "+e._s(e.$t("You can enable maintenance mode during application upgrade or when doing other service tasks, so nobody except administrators can use the website."))+"\n                  ")]),e._v(" "),n("v-form",{staticClass:"mt-5",on:{submit:function(t){return t.preventDefault(),e.switchMaintenanceMode(t)}},model:{value:e.maintenanceFormIsValid,callback:function(t){e.maintenanceFormIsValid=t},expression:"maintenanceFormIsValid"}},[n("v-text-field",{attrs:{label:e.$t("Message"),rules:[e.validationRequired],error:e.maintenanceForm.errors.has("message"),"error-messages":e.maintenanceForm.errors.get("message"),disabled:void 0===e.data.maintenance_mode||e.data.maintenance_mode,outlined:""},model:{value:e.maintenanceForm.message,callback:function(t){e.$set(e.maintenanceForm,"message",t)},expression:"maintenanceForm.message"}}),e._v(" "),n("v-skeleton-loader",{attrs:{type:"button",loading:void 0===e.data.maintenance_mode}},[n("v-btn",{attrs:{type:"submit",color:"primary",disabled:!e.maintenanceFormIsValid||e.maintenanceForm.busy,loading:e.maintenanceForm.busy}},[e.data.maintenance_mode?[e._v("\n                          "+e._s(e.$t("Disable maintenance mode"))+"\n                        ")]:[e._v("\n                          "+e._s(e.$t("Enable maintenance mode"))+"\n                        ")]],2)],1)],1)],1)],1)],1)],1),e._v(" "),n("v-row",[n("v-col",[n("v-card",{attrs:{outlined:""}},[n("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Tasks"))+"\n                ")]),e._v(" "),n("v-card-text",[n("p",[e._v("\n                    "+e._s(e.$t("The app provides a number of service tasks, which can be executed on demand."))+"\n                  ")]),e._v(" "),n("v-form",{staticClass:"mt-5",on:{submit:function(t){return t.preventDefault(),e.executeCommand(t)}},model:{value:e.commandFormIsValid,callback:function(t){e.commandFormIsValid=t},expression:"commandFormIsValid"}},[n("v-select",{attrs:{items:e.commands,label:e.$t("Task"),error:e.commandForm.errors.has("command"),"error-messages":e.commandForm.errors.get("command"),outlined:"",disabled:!e.data.commands},model:{value:e.commandForm.command,callback:function(t){e.$set(e.commandForm,"command",t)},expression:"commandForm.command"}}),e._v(" "),e.commandForm.command?[e._l(e.data.commands,(function(t){return[t.class===e.commandForm.command?e._l(t.arguments,(function(t,a){return n("v-text-field",{key:a,attrs:{label:e.$t(t.title),rules:[e.validationRequired],placeholder:t.default,error:e.commandForm.errors.has("arguments"),"error-messages":e.commandForm.errors.get("arguments"),outlined:""},model:{value:e.commandForm.arguments[t.id],callback:function(n){e.$set(e.commandForm.arguments,t.id,n)},expression:"commandForm.arguments[arg.id]"}})})):e._e()]}))]:e._e(),e._v(" "),n("v-skeleton-loader",{attrs:{type:"button",loading:void 0===e.data.commands}},[n("v-btn",{attrs:{type:"submit",color:"primary",disabled:!e.commandForm.command||!e.commandFormIsValid||e.commandForm.busy,loading:e.commandForm.busy}},[e._v("\n                        "+e._s(e.$t("Execute"))+"\n                      ")])],1)],2)],1)],1)],1)],1),e._v(" "),n("v-row",[n("v-col",[n("v-card",{attrs:{outlined:""}},[n("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Database"))+"\n                ")]),e._v(" "),n("v-card-text",[n("p",[e._v("\n                    "+e._s(e.$t("After upgrading to a new version of the application it is necessary to update the database objects."))+"\n                    "+e._s(e.$t("All current data will be preserved."))+"\n                  ")]),e._v(" "),n("v-form",{on:{submit:function(t){return t.preventDefault(),e.migrate(t)}}},[n("v-btn",{attrs:{type:"submit",color:"primary",disabled:e.migrationForm.busy,loading:e.migrationForm.busy}},[e._v("\n                      "+e._s(e.$t("Update database"))+"\n                    ")])],1)],1)],1)],1)],1),e._v(" "),n("v-row",[n("v-col",[n("v-card",{attrs:{outlined:""}},[n("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Cache"))+"\n                ")]),e._v(" "),n("v-card-text",[n("p",[e._v("\n                  "+e._s(e.$t("The application caches templates, configuration, translation strings, aggregated data etc to improve performance."))+"\n                  "+e._s(e.$t("To clear all caches at once click the button below."))+"\n                  ")]),e._v(" "),n("v-form",{on:{submit:function(t){return t.preventDefault(),e.clearCache(t)}}},[n("v-btn",{attrs:{type:"submit",color:"primary",disabled:e.cacheForm.busy,loading:e.cacheForm.busy}},[e._v("\n                      "+e._s(e.$t("Clear cache"))+"\n                    ")])],1)],1)],1)],1)],1),e._v(" "),n("v-row",[n("v-col",[n("v-card",{attrs:{outlined:""}},[n("v-card-title",{staticClass:"font-weight-thin"},[e._v("\n                  "+e._s(e.$t("Cron"))+"\n                ")]),e._v(" "),n("v-card-text",[n("p",[e._v("\n                    "+e._s(e.$t("Certain application tasks are supposed to run automatically on a regular basis."))+"\n                    "+e._s(e.$t("To make it work please add the following system cron job."))+"\n                    "+e._s(e.$t("Please note that the command-line (cli) PHP version on your server should also meet the minimum PHP version requirements, otherwise the cron job will fail to execute."))+"\n                    "+e._s(e.$t("If you add the cron job via cPanel you need to omit the leading asteriks symbols."))+"\n                  ")]),e._v(" "),n("v-form",{on:{submit:function(t){return t.preventDefault(),e.cron(t)}}},[n("v-text-field",{ref:"cron",attrs:{dense:"",outlined:"",readonly:"","append-icon":"mdi-content-copy",value:e.data.cron_job,disabled:!e.data.cron_job},on:{"click:append":function(t){return e.copyToClipboard(e.$refs.cron)}}}),e._v(" "),n("v-btn",{attrs:{type:"submit",color:"primary",disabled:e.cronForm.busy,loading:e.cronForm.busy}},[e._v("\n                      "+e._s(e.$t("Execute cron job manually"))+"\n                    ")])],1)],1)],1)],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,null,null);const Z=I.exports;f()(I,{VBtn:h.Z,VCard:b.Z,VCardText:g.ZB,VCardTitle:g.EB,VCol:w.Z,VContainer:x.Z,VForm:F.Z,VIcon:y.Z,VRow:$.Z,VSelect:k.Z,VSkeletonLoader:C.Z,VTextField:V.Z})}}]);
//# sourceMappingURL=admin-maintenance.js.map